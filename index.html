<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Move to Islam</title>
    
    <meta name="theme-color" content="#020811">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Move%20to%20Islam%22,%22short_name%22:%22MTI%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#020811%22,%22theme_color%22:%22#4ade80%22}">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --accent: #D4AF37; --primary: #4ade80; --bg: #020811; --glass: rgba(255,255,255,0.05); --border: rgba(255,255,255,0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: #fff; font-family: 'Poppins', sans-serif; margin: 0; height: 100vh; overflow: hidden; }

        /* --- UI Components --- */
        .app-bar { padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; background: rgba(2,8,17,0.9); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border); }
        .menu-icon { font-size: 22px; color: var(--primary); background: var(--glass); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 12px; cursor: pointer; }
        
        .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: #020811; z-index: 10001; transition: 0.4s; padding: 40px 20px; border-right: 1px solid var(--border); }
        .sidebar.open { left: 0; }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; z-index: 10000; }

        .page-container { height: calc(100vh - 70px); overflow-y: auto; padding-bottom: 100px; scroll-behavior: smooth; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Cards --- */
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .dash-card { background: var(--glass); border: 1px solid var(--border); padding: 20px; border-radius: 20px; text-align: center; cursor: pointer; }
        .dash-card i { font-size: 24px; color: var(--accent); margin-bottom: 10px; }

        /* --- Tasbih --- */
        .tasbih-circle { width: 180px; height: 180px; border: 8px solid var(--primary); border-radius: 50%; margin: 30px auto; display: flex; align-items: center; justify-content: center; font-size: 50px; font-weight: 700; cursor: pointer; box-shadow: 0 0 30px rgba(74,222,128,0.2); transition: 0.1s; }
        .tasbih-circle:active { transform: scale(0.95); }

        /* --- Install Bar --- */
        #install-bar { position: fixed; top: 0; left: 0; right: 0; background: #ff5722; color: #fff; padding: 12px 20px; display: none; align-items: center; justify-content: space-between; z-index: 20000; font-weight: 600; }

        /* --- Navbar --- */
        .navbar { position: fixed; bottom: 15px; left: 15px; right: 15px; height: 70px; background: rgba(2,8,17,0.95); border-radius: 25px; border: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 999; backdrop-filter: blur(10px); }
        .nav-link { color: rgba(255,255,255,0.3); text-align: center; font-size: 10px; cursor: pointer; flex: 1; }
        .nav-link.active { color: var(--primary); }
        .nav-link i { font-size: 20px; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="install-bar">
        <span><i class="fa-solid fa-download"></i> Install Move to Islam</span>
        <button onclick="triggerInstall()" style="background:#fff; border:none; padding:5px 12px; border-radius:5px; color:#ff5722; font-weight:700">INSTALL</button>
    </div>

    <div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div style="text-align:center; border-bottom: 1px solid var(--border); padding-bottom: 20px; margin-bottom: 20px;">
            <img id="side-avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" style="width:80px; height:80px; border-radius:50%; border:2px solid var(--accent); object-fit: cover;">
            <h4 id="side-name" style="margin:10px 0 0;">User</h4>
        </div>
        <div class="menu-item" onclick="nav('tasbih', null); toggleMenu()" style="padding:12px; cursor:pointer;"><i class="fa-solid fa-calculator"></i> Tasbih Counter</div>
        <div class="menu-item" onclick="nav('names', null); loadNames(); toggleMenu()" style="padding:12px; cursor:pointer;"><i class="fa-solid fa-star-and-crescent"></i> 99 Names</div>
        <div class="menu-item" onclick="nav('kalima', null); loadKalima(); toggleMenu()" style="padding:12px; cursor:pointer;"><i class="fa-solid fa-book"></i> 5 Kalima</div>
        <div class="menu-item" onclick="nav('settings', null); toggleMenu()" style="padding:12px; cursor:pointer;"><i class="fa-solid fa-user-gear"></i> Profile Settings</div>
    </div>

    <div class="app-bar">
        <div class="menu-icon" onclick="toggleMenu()"><i class="fa-solid fa-bars-staggered"></i></div>
        <div style="font-weight:700; letter-spacing:1px;">MOVE TO ISLAM</div>
        <div class="menu-icon" onclick="location.reload()"><i class="fa-solid fa-rotate-right"></i></div>
    </div>

    <div class="page-container">
        <div id="home" class="page active">
            <div style="text-align:center; padding:30px 20px;">
                <h1 id="digital-time" style="font-size:45px; margin:0">00:00</h1>
                <p id="location-text" style="color:var(--primary); font-size:12px; letter-spacing:2px;">DHAKA, BANGLADESH</p>
            </div>
            <div id="prayer-list" style="padding:0 20px;"></div>
            
            <div class="card-grid">
                <div class="dash-card" onclick="nav('quran', null); loadSurahs();"><i class="fa-solid fa-book-quran"></i><br>Quran</div>
                <div class="dash-card" onclick="nav('tasbih', null)"><i class="fa-solid fa-fingerprint"></i><br>Tasbih</div>
                <div class="dash-card" onclick="nav('names', null); loadNames();"><i class="fa-solid fa-heart"></i><br>99 Names</div>
                <div class="dash-card" onclick="nav('kalima', null); loadKalima();"><i class="fa-solid fa-mosque"></i><br>Kalima</div>
            </div>
        </div>

        <div id="quran" class="page">
            <div id="surah-list"></div>
            <div id="ayah-view" style="display:none; padding:15px;">
                <button onclick="closeQuran()" style="background:var(--accent); border:none; padding:12px; border-radius:10px; width:100%; font-weight:700; margin-bottom:15px; color:#000;">← BACK TO SURAHS</button>
                <div id="ayah-list"></div>
            </div>
        </div>

        <div id="tasbih" class="page" style="text-align:center; padding:20px;">
            <h2 style="color:var(--accent)">Tasbih Counter</h2>
            <div class="tasbih-circle" onclick="countTasbih()" id="t-count">0</div>
            <button onclick="resetTasbih()" style="background:var(--glass); border:1px solid var(--border); color:#fff; padding:12px 40px; border-radius:15px;">Reset</button>
        </div>

        <div id="names" class="page" style="padding:20px;">
            <h2 style="color:var(--accent); text-align:center;">Allah's 99 Names</h2>
            <div id="names-list" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
        </div>

        <div id="kalima" class="page" style="padding:20px;">
            <h2 style="color:var(--accent); text-align:center;">৫টি কালিমা</h2>
            <div id="kalima-content"></div>
        </div>

        <div id="ai-tab" class="page">
            <div id="ai-box" style="height:55vh; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:10px;"></div>
            <div style="padding:15px; display:flex; gap:10px;">
                <input type="text" id="ai-in" style="flex:1; background:var(--glass); border:1px solid var(--border); color:#fff; padding:12px; border-radius:15px;" placeholder="Ask Islamic AI...">
                <button onclick="askAI()" style="background:var(--primary); border:none; width:50px; border-radius:15px; cursor:pointer;"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>

        <div id="settings" class="page" style="padding:20px;">
            <div style="background:var(--glass); padding:30px; border-radius:25px; text-align:center; border:1px solid var(--border);">
                <div style="position:relative; display:inline-block;">
                    <img id="preview-img" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" style="width:110px; height:110px; border-radius:50%; border:3px solid var(--accent); object-fit: cover;">
                    <button onclick="document.getElementById('file-input').click()" style="position:absolute; bottom:0; right:0; background:var(--primary); border:none; width:35px; height:35px; border-radius:50%; color:#000;"><i class="fa-solid fa-camera"></i></button>
                </div>
                <input type="file" id="file-input" style="display:none" accept="image/*">
                <input type="text" id="name-input" style="width:100%; padding:15px; border-radius:15px; background:rgba(0,0,0,0.3); border:1px solid var(--border); color:#fff; margin-top:25px; text-align:center;" placeholder="Enter Your Name">
                <button onclick="saveProfile()" style="width:100%; margin-top:20px; padding:15px; background:var(--primary); border:none; border-radius:15px; font-weight:700; color:#000; cursor:pointer;">UPDATE PROFILE</button>
            </div>
        </div>
    </div>

    <div class="navbar">
        <div class="nav-link active" onclick="nav('home', this)"><i class="fa-solid fa-house"></i>Home</div>
        <div class="nav-link" onclick="nav('quran', this); loadSurahs();"><i class="fa-solid fa-book-open"></i>Quran</div>
        <div class="nav-link" onclick="nav('ai-tab', this)"><i class="fa-solid fa-comments"></i>AI Chat</div>
        <div class="nav-link" onclick="nav('settings', this)"><i class="fa-solid fa-user-gear"></i>Profile</div>
    </div>

    <script>
        // --- Core Navigation ---
        let tValue = 0;
        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) el.classList.add('active');
            window.scrollTo(0,0);
        }

        function toggleMenu() {
            const side = document.getElementById('sidebar');
            const over = document.getElementById('overlay');
            side.classList.toggle('open');
            over.style.display = side.classList.contains('open') ? 'block' : 'none';
        }

        // --- Tasbih ---
        function countTasbih() {
            tValue++;
            document.getElementById('t-count').innerText = tValue;
            if(window.navigator.vibrate) window.navigator.vibrate(40);
        }
        function resetTasbih() { tValue = 0; document.getElementById('t-count').innerText = 0; }

        // --- Profile Fix (Permanent Storage) ---
        document.getElementById('file-input').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = () => {
                const imgData = reader.result;
                document.getElementById('preview-img').src = imgData;
                document.getElementById('side-avatar').src = imgData;
                localStorage.setItem('u_img', imgData);
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        function saveProfile() {
            const name = document.getElementById('name-input').value;
            if(name) {
                localStorage.setItem('u_name', name);
                document.getElementById('side-name').innerText = name;
            }
            Swal.fire({title:'Updated!', icon:'success', background:'#020811', color:'#fff', confirmButtonColor: '#4ade80'});
        }

        // --- 99 Names (API) ---
        async function loadNames() {
            const list = document.getElementById('names-list');
            if(list.innerHTML !== "") return;
            list.innerHTML = "<p>Loading...</p>";
            try {
                const res = await fetch('https://api.aladhan.com/v1/asmaAlHusna');
                const data = await res.json();
                list.innerHTML = data.data.map(n => `
                    <div style="background:var(--glass); padding:15px; border-radius:15px; text-align:center; border:1px solid var(--border);">
                        <div style="font-size:20px; color:var(--accent); font-weight:700;">${n.name}</div>
                        <div style="font-size:12px; color:#fff;">${n.transliteration}</div>
                        <div style="font-size:10px; color:var(--primary);">${n.en.meaning}</div>
                    </div>
                `).join('');
            } catch { list.innerHTML = "Internet Required."; }
        }

        // --- 5 Kalima ---
        function loadKalima() {
            const content = document.getElementById('kalima-content');
            const data = [
                {t:"কালিমা তাইয়্যিবা", ar:"لَا إِلٰهَ إِلَّا اللهُ مُحَمَّدٌ رَسُولُ اللهِ", bn:"আল্লাহ ছাড়া কোনো উপাস্য নেই, মুহাম্মদ (সা.) আল্লাহর রাসূল।"},
                {t:"কালিমা শাহাদাত", ar:"أَشْهَدُ أَنْ لَا إِلٰهَ إِلَّا اللهُ وَأَشْهَدُ أَنَّ مُحَمَّدًا عَبْدُهُ وَرَسُولُهُ", bn:"আমি সাক্ষ্য দিচ্ছি যে আল্লাহ ছাড়া কোনো উপাস্য নেই এবং মুহাম্মদ (সা.) তাঁর বান্দা ও রাসূল।"},
                {t:"কালিমা তাওহীদ", ar:"لَا إِلٰهَ إِلَّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ يُحْيِي وَيُمِيتُ وَهُوَ حَيٌّ لَا يَمُوتُ أَبَدًا أَبَدًا، ذُو الْجَلَالِ وَالْإِكْرَامِ بِيَدِهِ الْخَيْرُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ", bn:"আল্লাহ ছাড়া কোনো উপাস্য নেই, তিনি এক, তাঁর কোনো শরিক নেই..."},
                {t:"কালিমা তামজীদ", ar:"سُبْحَانَ اللهِ وَالْحَمْدُ لِلَّهِ وَلَا إِلٰهَ إِلَّا اللهُ وَاللهُ أَكْبَرُ وَلَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ الْعَلِيِّ الْعَظِيمِ", bn:"আল্লাহ পবিত্র, সকল প্রশংসা আল্লাহর জন্য..."},
                {t:"কালিমা রদ্দে কুফর", ar:"اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ أَنْ أُشْرِكَ بِكَ شَيْئًا وَأَنَا أَعْلَمُ بِهِ", bn:"হে আল্লাহ! আমি তোমার কাছে আশ্রয় চাচ্ছি যেন আমি জেনে শুনে তোমার সাথে কাউকে শরিক না করি..."}
            ];
            content.innerHTML = data.map(k => `
                <div style="background:var(--glass); padding:15px; border-radius:15px; margin-bottom:12px; border:1px solid var(--border);">
                    <h3 style="color:var(--primary); margin:0 0 10px;">${k.t}</h3>
                    <p style="font-size:20px; text-align:right; color:var(--accent); line-height:1.6;">${k.ar}</p>
                    <p style="font-size:13px; color:#ccc;">${k.bn}</p>
                </div>
            `).join('');
        }

        // --- Quran Logic ---
        async function loadSurahs() {
            const list = document.getElementById('surah-list');
            if(list.innerHTML !== "") return;
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            list.innerHTML = data.data.map(s => `
                <div style="background:var(--glass); margin:10px 20px; padding:15px; border-radius:15px; display:flex; justify-content:space-between; align-items:center; border:1px solid var(--border);" onclick="loadAyahs(${s.number})">
                    <div><b>${s.number}. ${s.englishName}</b><br><small>${s.numberOfAyahs} Ayahs</small></div>
                    <div style="color:var(--accent); font-size:20px;">${s.name}</div>
                </div>
            `).join('');
        }
        async function loadAyahs(id) {
            document.getElementById('surah-list').style.display = 'none';
            const view = document.getElementById('ayah-view');
            const list = document.getElementById('ayah-list');
            view.style.display = 'block';
            list.innerHTML = "Loading...";
            const [ar, bn] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${id}`).then(r => r.json()),
                fetch(`https://api.alquran.cloud/v1/surah/${id}/bn.bengali`).then(r => r.json())
            ]);
            list.innerHTML = ar.data.ayahs.map((a, i) => `<div style="padding:15px; border-bottom:1px solid var(--border)"><div style="font-size:24px; text-align:right; color:var(--accent);">${a.text}</div><div style="font-size:14px; color:#ccc; margin-top:5px;">${bn.data.ayahs[i].text}</div></div>`).join('');
        }
        function closeQuran() { document.getElementById('surah-list').style.display = 'block'; document.getElementById('ayah-view').style.display = 'none'; }

        // --- AI Chat ---
        async function askAI() {
            const inpt = document.getElementById('ai-in');
            const box = document.getElementById('ai-box');
            if(!inpt.value) return;
            const q = inpt.value;
            box.innerHTML += `<div style="align-self:flex-end; background:var(--accent); color:#000; padding:12px; border-radius:15px; max-width:85%; font-size:14px; font-weight:600;">${q}</div>`;
            inpt.value = "";
            const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(q)}?system=Islamic scholar assistant.`);
            const text = await res.text();
            box.innerHTML += `<div style="align-self:flex-start; background:var(--glass); border:1px solid var(--border); padding:12px; border-radius:15px; max-width:85%; font-size:14px;">${text}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        // --- Clock & Prayers ---
        setInterval(() => { document.getElementById('digital-time').innerText = new Date().toLocaleTimeString('en-GB', {hour:'2-digit', minute:'2-digit'}); }, 1000);
        async function getPrayers() {
            const res = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Dhaka&country=Bangladesh&method=2');
            const data = await res.json();
            const t = data.data.timings;
            document.getElementById('prayer-list').innerHTML = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].map(p => `
                <div style="background:var(--glass); margin-bottom:8px; padding:12px 20px; border-radius:15px; display:flex; justify-content:space-between; border:1px solid var(--border)">
                    <span>${p}</span><span style="color:var(--primary); font-weight:700;">${t[p]}</span>
                </div>
            `).join('');
        }
        getPrayers();

        // --- APK Install (PWA) ---
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-bar').style.display = 'flex';
        });
        function triggerInstall() {
            if(deferredPrompt) {
                deferredPrompt.prompt();
                document.getElementById('install-bar').style.display = 'none';
            } else {
                Swal.fire({text: 'To install, open this in Chrome browser and click "Add to Home Screen"', ico
