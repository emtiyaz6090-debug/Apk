<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Pro - Royal Edition</title>
    
    <meta name="theme-color" content="#020d18">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Islamic%20Pro%22,%22short_name%22:%22EmtiPro%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#020d18%22,%22theme_color%22:%22#4ade80%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/2855/2855013.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22}]}">

    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --gold: #c6a664; --primary: #4ade80; --deep: #020d18; --glass: rgba(255, 255, 255, 0.08); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            background: var(--deep);
            background-image: radial-gradient(circle at top right, #0a1f33, #020d18);
            color: #fff; font-family: 'Hind Siliguri', sans-serif; margin: 0; padding-bottom: 100px;
            overflow-x: hidden;
        }

        /* Royal Header */
        .top-status { padding: 40px 20px 20px; text-align: center; }
        #welcome-msg { font-size: 18px; color: var(--gold); margin-bottom: 5px; font-weight: 300; }
        #loc-text { font-size: 14px; opacity: 0.7; color: var(--primary); }

        /* Analog Clock Container */
        .clock-box {
            width: 180px; height: 180px; margin: 20px auto;
            border: 2px solid rgba(198, 166, 100, 0.3); border-radius: 50%;
            position: relative; background: rgba(0,0,0,0.2);
            box-shadow: 0 0 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(74, 222, 128, 0.05);
        }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; border-radius: 5px; transform: translateX(-50%); }
        .h-hand { width: 5px; height: 45px; background: var(--gold); z-index: 3; }
        .m-hand { width: 3px; height: 65px; background: #fff; z-index: 2; }
        .s-hand { width: 1.5px; height: 75px; background: #ff4757; z-index: 4; }
        .center-dot { position: absolute; top:50%; left:50%; width:10px; height:10px; background:var(--gold); border-radius:50%; transform:translate(-50%,-50%); z-index:5; }

        /* Digital Display */
        .time-display { text-align: center; margin-bottom: 30px; }
        #digital-clock { font-size: 45px; font-weight: 700; color: #fff; letter-spacing: 2px; }
        #date-bn { opacity: 0.6; font-size: 16px; margin-top: 5px; }

        /* Fasting Cards (The Royal Feel) */
        .fasting-container { display: flex; gap: 15px; padding: 0 20px; margin-bottom: 30px; }
        .f-card {
            flex: 1; background: var(--glass); padding: 20px; border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.1); text-align: center;
            backdrop-filter: blur(10px);
        }
        .f-card i { color: var(--gold); font-size: 20px; margin-bottom: 10px; display: block; }
        .f-card span { font-size: 12px; opacity: 0.6; display: block; text-transform: uppercase; }
        .f-card b { font-size: 20px; color: var(--primary); margin-top: 5px; display: block; }

        /* Prayer Times List */
        .prayer-list { padding: 0 20px; }
        .p-row {
            background: var(--glass); margin-bottom: 12px; padding: 15px 20px;
            border-radius: 18px; display: flex; justify-content: space-between;
            align-items: center; border: 1px solid rgba(255,255,255,0.03);
            transition: 0.3s;
        }
        .p-row:hover { border-color: var(--primary); background: rgba(74, 222, 128, 0.05); }
        .p-name { display: flex; align-items: center; gap: 15px; font-weight: 600; }
        .p-time { color: var(--gold); font-weight: 700; font-size: 18px; }

        /* Navigation */
        .nav-bar {
            position: fixed; bottom: 20px; left: 20px; right: 20px; height: 75px;
            background: rgba(10, 31, 51, 0.95); backdrop-filter: blur(20px);
            border-radius: 25px; border: 1px solid rgba(198, 166, 100, 0.2);
            display: flex; justify-content: space-around; align-items: center; z-index: 1000;
        }
        .nav-item { color: rgba(255,255,255,0.3); text-align: center; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--primary); transform: translateY(-5px); }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 4px; }

        /* Quran & Others */
        .page { display: none; padding: 20px; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Profile Input */
        .input-group { background: var(--glass); padding: 30px; border-radius: 25px; border: 1px solid var(--border); }
        input { 
            width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2); color: #fff; font-size: 16px; margin-bottom: 20px;
        }
        .btn-royal {
            width: 100%; padding: 15px; background: linear-gradient(45deg, var(--primary), #2d9d5d);
            border: none; border-radius: 12px; color: #000; font-weight: 800; cursor: pointer;
        }

        /* PWA Button */
        #install-row {
            background: var(--gold); color: #000; padding: 10px; text-align: center;
            font-weight: 700; display: none; cursor: pointer;
        }

        #quran-viewer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; color: #222; z-index: 2000; display: none; flex-direction: column; }
        .viewer-header { background: var(--deep); color: #fff; padding: 20px; display: flex; align-items: center; gap: 15px; }
        .viewer-content { flex: 1; overflow-y: auto; padding: 25px; line-height: 2.5; font-size: 18px; }

        .tasbih-btn { width: 220px; height: 220px; border: 8px solid var(--gold); border-radius: 50%; margin: 40px auto; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(198, 166, 100, 0.05); cursor: pointer; box-shadow: 0 10px 40px rgba(0,0,0,0.4); }
        #t-count { font-size: 60px; font-weight: 700; color: var(--primary); }
    </style>
</head>
<body>

    <div id="install-row" onclick="installPWA()">
        <i class="fa-solid fa-cloud-arrow-down"></i> INSTALL APP FOR BETTER EXPERIENCE
    </div>

    <div id="home" class="page active">
        <div class="top-status">
            <div id="welcome-msg">আসসালামু আলাইকুম</div>
            <div id="loc-text"><i class="fa-solid fa-location-dot"></i> লোকেশন খোঁজা হচ্ছে...</div>
        </div>

        <div class="clock-box">
            <div class="hand h-hand" id="hh"></div>
            <div class="hand m-hand" id="mh"></div>
            <div class="hand s-hand" id="sh"></div>
            <div class="center-dot"></div>
        </div>

        <div class="time-display">
            <div id="digital-clock">00:00:00</div>
            <div id="date-bn">লোডিং...</div>
        </div>

        <div class="fasting-container">
            <div class="f-card">
                <i class="fa-solid fa-moon"></i>
                <span>সাহরির শেষ</span>
                <b id="sehri">--:--</b>
            </div>
            <div class="f-card">
                <i class="fa-solid fa-sun"></i>
                <span>ইফতারের শুরু</span>
                <b id="iftar">--:--</b>
            </div>
        </div>

        <div class="prayer-list" id="p-list">
            </div>

        <div style="text-align: center; margin-top: 30px; opacity: 0.3; font-size: 12px; letter-spacing: 5px;">
            DESIGNED BY EMTI
        </div>
    </div>

    <div id="quran" class="page">
        <h2 style="color:var(--gold); margin-bottom:20px;">পবিত্র কুরআন</h2>
        <div id="s-list"></div>
    </div>

    <div id="tasbih" class="page">
        <h2 style="color:var(--gold); text-align:center;">ডিজিটাল তসবিহ</h2>
        <div class="tasbih-btn" onclick="countT()">
            <span id="t-count">0</span>
            <span style="opacity:0.5; font-size:14px;">ট্যাপ করুন</span>
        </div>
        <button class="btn-royal" style="background:none; border:1px solid var(--gold); color:var(--gold);" onclick="resetT()">রিসেট</button>
    </div>

    <div id="user" class="page">
        <h2 style="color:var(--gold)">ইউজার প্রোফাইল</h2>
        <div class="input-group">
            <label style="display:block; margin-bottom:10px; opacity:0.7;">আপনার নাম লিখুন</label>
            <input type="text" id="user-name-input" placeholder="উদা: ইমতিয়াজ">
            <button class="btn-royal" onclick="saveName()">সেভ করুন</button>
        </div>
    </div>

    <div id="quran-viewer">
        <div class="viewer-header">
            <i class="fa-solid fa-chevron-left" onclick="closeQuran()" style="font-size:24px; cursor:pointer;"></i>
            <span id="q-title" style="font-size:20px; font-weight:700;">সূরা</span>
        </div>
        <div id="audio-player-box" style="padding:15px; background:#f8f9fa;"></div>
        <div class="viewer-content" id="q-content"></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showPage('home', this)"><i class="fa-solid fa-kaaba"></i>হোম</div>
        <div class="nav-item" onclick="showPage('quran', this)"><i class="fa-solid fa-book-open"></i>কুরআন</div>
        <div class="nav-item" onclick="showPage('tasbih', this)"><i class="fa-solid fa-fingerprint"></i>তসবিহ</div>
        <div class="nav-item" onclick="showPage('user', this)"><i class="fa-solid fa-user-gear"></i>সেটিংস</div>
    </div>

    <script>
        // 1. Storage & Welcome
        function initUser() {
            const savedName = localStorage.getItem('emti_user');
            if(savedName) {
                document.getElementById('welcome-msg').innerText = `আসসালামু আলাইকুম, ${savedName}`;
                document.getElementById('user-name-input').value = savedName;
            }
        }

        function saveName() {
            const name = document.getElementById('user-name-input').value;
            if(name) {
                localStorage.setItem('emti_user', name);
                document.getElementById('welcome-msg').innerText = `আসসালামু আলাইকুম, ${name}`;
                alert("নাম সফলভাবে সেভ হয়েছে!");
            }
        }

        // 2. Navigation
        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        // 3. Royal Clock System
        setInterval(() => {
            const now = new Date();
            document.getElementById('digital-clock').innerText = now.toLocaleTimeString('en-US', {hour12: false});
            document.getElementById('date-bn').innerText = now.toLocaleDateString('bn-BD', {weekday:'long', day:'numeric', month:'long', year:'numeric'});

            const s = now.getSeconds(), m = now.getMinutes(), h = now.getHours();
            document.getElementById('sh').style.transform = `translateX(-50%) rotate(${s * 6}deg)`;
            document.getElementById('mh').style.transform = `translateX(-50%) rotate(${m * 6}deg)`;
            document.getElementById('hh').style.transform = `translateX(-50%) rotate(${(h % 12) * 30 + m * 0.5}deg)`;
        }, 1000);

        // 4. API & Location (Muzammil Algorithm)
        async function getTimes(lat, lon) {
            try {
                const response = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=1`);
                const data = await response.json();
                const t = data.data.timings;
                
                document.getElementById('loc-text').innerHTML = `<i class="fa-solid fa-circle-check"></i> লাইভ লোকেশন আপডেট সম্পন্ন`;
                document.getElementById('sehri').innerText = t.Fajr;
                document.getElementById('iftar').innerText = t.Maghrib;

                const prayers = [
                    {n: 'ফজর', t: t.Fajr, i: 'fa-cloud-moon'},
                    {n: 'যোহর', t: t.Dhuhr, i: 'fa-sun'},
                    {n: 'আসর', t: t.Asr, i: 'fa-cloud-sun'},
                    {n: 'মাগরিব', t: t.Maghrib, i: 'fa-moon'},
                    {n: 'এশা', t: t.Isha, i: 'fa-star-and-crescent'}
                ];

                document.getElementById('p-list').innerHTML = prayers.map(p => `
                    <div class="p-row">
                        <div class="p-name"><i class="fa-solid ${p.i}" style="color:var(--primary)"></i> ${p.n}</div>
                        <div class="p-time">${p.t}</div>
                    </div>
                `).join('');

            } catch(e) { 
                document.getElementById('loc-text').innerText = "নেটওয়ার্ক সমস্যা!";
            }
        }

        function askLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => getTimes(pos.coords.latitude, pos.coords.longitude),
                    () => getTimes(23.8103, 90.4125) // Dhaka Default
                );
            }
        }

        // 5. Quran System
        async function loadQuran() {
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            document.getElementById('s-list').innerHTML = data.data.slice(0, 114).map(s => `
                <div class="p-row" style="cursor:pointer" onclick="openQuran(${s.number}, '${s.name}')">
                    <div class="p-name"><span>${s.number}.</span> ${s.englishName}</div>
                    <div class="p-time"><i class="fa-solid fa-play"></i></div>
                </div>
            `).join('');
        }

        async function openQuran(id, name) {
            const viewer = document.getElementById('quran-viewer');
            viewer.style.display = 'flex';
            document.getElementById('q-title').innerText = name;
            document.getElementById('audio-player-box').innerHTML = `<audio controls src="https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/${id}.mp3" style="width:100%"></audio>`;
            
            const [ar, bn] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${id}`),
                fetch(`https://api.alquran.cloud/v1/surah/${id}/bn.bengali`)
            ]);
            const arD = await ar.json(), bnD = await bn.json();
            
            document.getElementById('q-content').innerHTML = arD.data.ayahs.map((a, i) => `
                <div style="margin-bottom:30px; border-bottom:1px solid #eee; padding-bottom:15px;">
                    <p style="text-align:right; font-size:26px; color:#1a472a; margin-bottom:10px;">${a.text}</p>
                    <p style="font-size:16px; color:#666;">${bnD.data.ayahs[i].text}</p>
                </div>
            `).join('');
        }

        function closeQuran() { document.getElementById('quran-viewer').style.display = 'none'; }

        // 6. Tasbih & PWA
        let tCount = 0;
        function countT() { tCount++; document.getElementById('t-count').innerText = tCount; if(navigator.vibrate) navigator.vibrate(50); }
        function resetT() { tCount = 0; document.getElementById('t-count').innerText = 0; }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-row').style.display = 'block';
        });

        async function installPWA() {
            if(deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') document.getElementById('install-row').style.display = 'none';
                deferredPrompt = null;
            }
        }

        // Initialize
        initUser();
        askLocation();
        loadQuran();
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,self.addEventListener("fetch", (e) => {});');
        }
    </script>
</body>
</html>
